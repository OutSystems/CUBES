
------------------------------------- R Solution ---------------------------------------

con <- DBI::dbConnect(RSQLite::SQLite(), ":memory:")
input1 <- read_csv("tests-examples/scythe/top_rated_posts/tables/i055.csv", col_types = cols(ID = col_integer(),User = col_character(),Activity = col_character(),PageURL = col_character()))
input1 <- copy_to(con, input1)
expected_output <- read_csv("tests-examples/scythe/top_rated_posts/tables/o055.csv", col_types = cols(User = col_character(),Activity = col_character(),concatPageURL = col_character()))

string_agg <- function(v,s) {Reduce(function(x, y) paste(x, y, sep = s), v)}

df2 <- input1 %>% group_by(Activity, User) %>% summarise(concatPageURL = string_agg(PageURL, ' ')) %>% ungroup()
df3 <- inner_join(input1, df2)
out <- df3 %>% select(User, Activity, concatPageURL) %>% distinct()


+++++++++++++++++++++++++++++++++++++ SQL Solution +++++++++++++++++++++++++++++++++++++

SELECT DISTINCT `User`,
                `Activity`,
                `concatPageURL`
FROM
  (SELECT `ID`,
          `User`,
          `Activity`,
          `PageURL`,
          `concatPageURL`
   FROM `input1` AS `LHS`
   INNER JOIN
     (SELECT `Activity`,
             `User`,
             string_agg(`PageURL`, ' ') AS `concatPageURL`
      FROM `input1`
      GROUP BY `Activity`,
               `User`) AS `RHS` ON (`LHS`.`User` = `RHS`.`User`
                                    AND `LHS`.`Activity` = `RHS`.`Activity`))
