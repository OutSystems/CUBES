
------------------------------------- R Solution ---------------------------------------

con <- DBI::dbConnect(RSQLite::SQLite(), ":memory:")
input1 <- read_csv("tests-examples/scythe/recent_posts/tables/040.csv", col_types = cols(id = col_integer(),timestamp = col_integer(),first_name = col_character(),last_name = col_character(),action = col_character()))
input1 <- copy_to(con, input1)
expected_output <- read_csv("tests-examples/scythe/recent_posts/tables/040_o.csv", col_types = cols(id = col_integer(),timestamp = col_integer(),first_name = col_character(),last_name = col_character(),action = col_character()))

df2 <- input1 %>% group_by(action) %>% summarise(n = n()) %>% ungroup()
df3 <- df2 %>% filter(n <= 2)
df4 <- inner_join(input1, df3, by=c('id' = 'n','n' = 'n'), suffix = c('', '.other'))
out <- df4 %>% select(id, timestamp, first_name, last_name, action) %>% distinct()


+++++++++++++++++++++++++++++++++++++ SQL Solution +++++++++++++++++++++++++++++++++++++

SELECT DISTINCT `id`,
                `timestamp`,
                `first_name`,
                `last_name`,
                `action`
FROM
  (SELECT `id`,
          `timestamp`,
          `first_name`,
          `last_name`,
          `action`,
          `action.other`
   FROM `input1` AS `LHS`
   INNER JOIN
     (SELECT *
      FROM
        (SELECT `action`,
                COUNT() AS `n`
         FROM `input1`
         GROUP BY `action`)
      WHERE (`n` <= 2.0)) AS `RHS` ON (`LHS`.`id` = `RHS`.`n`))
