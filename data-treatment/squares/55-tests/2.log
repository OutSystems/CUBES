R[write to console]: 
Attaching package: ‘dplyr’


R[write to console]: The following objects are masked from ‘package:stats’:

    filter, lag


R[write to console]: The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union


R[write to console]: 
Attaching package: ‘dbplyr’


R[write to console]: The following objects are masked from ‘package:dplyr’:

    ident, sql


# First, specify the types that will be used

enum Cols {
  "C_name, F_key", "C_name, F_name", "C_name, S_key", "C_name, age", "C_name, major", "F_key, C_name", "F_key, F_name", "F_key, S_key", "F_key, age", "F_key, major", "F_name, C_name", "F_name, F_key", "F_name, S_key", "F_name, age", "F_name, major", "S_key, C_name", "S_key, F_key", "S_key, F_name", "S_key, age", "S_key, major", "age, C_name", "age, F_key", "age, F_name", "age, S_key", "age, major", "major, C_name", "major, F_key", "major, F_name", "major, S_key", "major, age", "C_name", "F_key", "F_name", "S_key", "age", "major"
}

enum Col {
  "C_name", "F_key", "F_name", "S_key", "age", "major"
}

enum SelectCols{
  "maxage"
}

enum Distinct {
	"distinct", ""
}

enum FilterCondition{
"F_name == faculty1", "F_name != faculty1", "major == History", "major != History", "age == maxage", "age > maxage", "age < maxage", "age >= maxage", "age <= maxage"
}

enum SummariseCondition{
"maxage = max(age)"
}

enum Op{
 "|", "&"
}

value Table {
  col: int;
  row: int;
}

value TableSelect {
  col: int;
  row: int;
}

value Empty;

# Next, specify the input/output of the synthesized program
program Squares(Table, Table, Table, Table) -> TableSelect;

# Finally, specify the production rules
func empty: Empty -> Empty;

func inner_join: Table r -> Table a, Table b
{
  col(r) <= col(a) + col(b);
}

func inner_join3: Table r -> Table a, Table b, Table c
{
  col(r) < col(a) + col(b) + col(c);
}

func inner_join4: Table r -> Table a, Table b, Table c, Table d {
  col(r) < col(a) + col(b) + col(c) + col(d);
}

func anti_join: Table r ->  Table a, Table b, Col c {
  #col(r) <= col(a) + col(b);
  col(r) == 1;
  row(r) <= row(a);
}

func left_join: Table r ->  Table a, Table b{
  col(r) <= col(a) + col(b);
  row(r) == row(a);
}

func bind_rows: Table r ->  Table a, Table b{
  col(r) <= col(a) + col(b);
  row(r) == row(a) + row(b);
}

func intersect: Table r ->  Table a, Table b, Col c {
  #col(r) <= col(a) + col(b);
  col(r) == 1;
  row(r) <= row(a);
}

func select: TableSelect r -> Table a, SelectCols c, Distinct d{
	row(r) <= row(a);
	col(r) <= col(a);
}




func filter: Table r -> Table a, FilterCondition f {
 row(r) <= row(a);
 col(r) == col(a);
}
func filters: Table r -> Table a, FilterCondition f, FilterCondition g, Op o {
 row(r) <= row(a);
 col(r) == col(a);
}


func summariseGrouped: Table r -> Table a, SummariseCondition s, Cols b {
 row(r) <= row(a);
 col(r) <= 3;
}

predicate is_not_parent(inner_join4, summariseGrouped, 100);
predicate is_not_parent(summariseGrouped, summariseGrouped, 100);
predicate distinct_filters(filters, 1, 2);

predicate is_not_parent(filters, filter, 100);
predicate is_not_parent(filter, filters, 100);
predicate is_not_parent(filter, filter, 100);
predicate is_not_parent(filters, filters, 100);

predicate constant_occurs("maxage = max(age)");
predicate constant_occurs("F_name == faculty1,F_name != faculty1");
predicate constant_occurs("major == History,major != History");
predicate happens_before("age == maxage","maxage = max(age)");
predicate happens_before("age > maxage","maxage = max(age)");
predicate happens_before("age < maxage","maxage = max(age)");
predicate happens_before("age >= maxage","maxage = max(age)");
predicate happens_before("age <= maxage","maxage = max(age)");
predicate is_not_parent(inner_join, inner_join3, 100);
predicate is_not_parent(inner_join, inner_join4, 100);
#predicate is_not_parent(inner_join, anti_join, 100);
predicate is_not_parent(inner_join3, inner_join, 100);
predicate is_not_parent(inner_join3, inner_join3, 100);
predicate is_not_parent(inner_join3, inner_join4, 100);
predicate is_not_parent(inner_join3, anti_join, 100);
predicate is_not_parent(inner_join4, inner_join, 100);
predicate is_not_parent(inner_join4, inner_join3, 100);
predicate is_not_parent(inner_join4, inner_join4, 100);
#predicate is_not_parent(inner_join4, anti_join, 100);
predicate is_not_parent(anti_join, anti_join, 100);
predicate is_not_parent(anti_join, inner_join, 100);
predicate is_not_parent(anti_join, inner_join4, 100);
predicate distinct_inputs(inner_join4);
predicate distinct_inputs(inner_join3);
predicate distinct_inputs(inner_join);
predicate distinct_inputs(anti_join);

Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "C_name"
Joining, by = "S_key"
Joining, by = "F_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"

------------------------------------- R Solution ---------------------------------------

con <- DBI::dbConnect(RSQLite::SQLite(), ":memory:")
input0 <- read.table("tests-examples/55-tests/tables/2-1.txt", sep =",", header=T)
input0
input0 <- copy_to(con,input0)
input1 <- read.table("tests-examples/55-tests/tables/2-2.txt", sep =",", header=T)
input1
input1 <- copy_to(con,input1)
input2 <- read.table("tests-examples/55-tests/tables/2-3.txt", sep =",", header=T)
input2
input2 <- copy_to(con,input2)
input3 <- read.table("tests-examples/55-tests/tables/2-4.txt", sep =",", header=T)
input3
input3 <- copy_to(con,input3)
expected_output <- read.table("tests-examples/55-tests/tables/2.out", sep =",", header=T)
expected_output

RET_DF934 <- inner_join(inner_join(inner_join(input1, input0), input2), input3)
RET_DF935 <- RET_DF934 %>% ungroup() %>% filter(F_name == "faculty1" & major != "History")
RET_DF936 <- RET_DF935 %>% group_by(F_key, F_name) %>% summarise(maxage = max(age))
RET_DF937 <- RET_DF936 %>% ungroup() %>% select(maxage)



+++++++++++++++++++++++++++++++++++++ SQL Solution +++++++++++++++++++++++++++++++++++++

Joining, by = "C_name"
Joining, by = "F_key"
Joining, by = "S_key"
SELECT `maxage`
FROM
  (SELECT `F_key`,
          `F_name`,
          MAX(`age`) AS `maxage`
   FROM
     (SELECT *
      FROM
        (SELECT `S_key`,
                `C_name`,
                `F_key`,
                `F_name`,
                `major`,
                `age`
         FROM
           (SELECT `S_key`,
                   `C_name`,
                   `F_key`,
                   `F_name`
            FROM
              (SELECT `S_key`,
                      `C_name`,
                      `F_key`
               FROM `input1` AS `LHS`
               INNER JOIN `input0` AS `RHS` ON (`LHS`.`C_name` = `RHS`.`C_name`)) AS `LHS`
            INNER JOIN `input2` AS `RHS` ON (`LHS`.`F_key` = `RHS`.`F_key`)) AS `LHS`
         INNER JOIN `input3` AS `RHS` ON (`LHS`.`S_key` = `RHS`.`S_key`))
      WHERE (`F_name` = 'faculty1'
             AND `major` != 'History'))
   GROUP BY `F_key`,
            `F_name`)

