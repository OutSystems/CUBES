inputs:
  - tests-examples/scythe/recent_posts/tables/027.csv
output: tests-examples/scythe/recent_posts/tables/027_o.csv
comment: |
  SELECT M1.*,
  (SELECT calls From mytable1 M2 where M2.ts=M1.ts and M2.s_no=M1.s_no) as calls
  FROM
  (
      select m.s_no, m.bucket_window, max(m.ts) ts
      from (
          select m.*, datepart(hour, m.ts)*2 + floor(datepart(minute, m.ts)/30) bucket_window
          from mytable1 m
          where m.ts >= DATEADD(dd, DATEDIFF(dd, 0, GETDATE()), 0)
      ) m
      group by m.s_no, m.bucket_window
  ) M1