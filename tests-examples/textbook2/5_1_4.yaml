inputs:
  - 'tests-examples/textbook2/tables/student.csv'
  - 'tests-examples/textbook2/tables/class.csv'
  - 'tests-examples/textbook2/tables/enrolled.csv'
#  - 'tests-examples/textbook2/tables/faculty.csv'
output: 'tests-examples/textbook2/tables/5_1_4.csv'
const:
  - 2
aggrs:
  - n
loc: 2
comment: |
  SELECT DISTINCT S.sname
  FROM Student S
  WHERE S.snum IN (SELECT E1.snum
                   FROM Enrolled E1,
                        Enrolled E2,
                        Class C1,
                        Class C2
                   WHERE E1.snum = E2.snum
                     AND E1.cname <> E2.cname
                     AND E1.cname = C1.name
                     AND E2.cname = C2.name
                     AND C1.meets_at = C2.meets_at)

  df1 <- inner_join(inner_join(input3, input2), input1)
  df2 <- df1 %>% group_by(meets_at, sname) %>% summarise(n = n()) %>% ungroup()
  df3 <- df2 %>% filter(n == 2)
  out <- df3 %>% select(sname)