inputs:
  - 'tests-examples/textbook2/tables/student.csv'
  - 'tests-examples/textbook2/tables/class.csv'
  - 'tests-examples/textbook2/tables/enrolled.csv'
  - 'tests-examples/textbook2/tables/faculty.csv'
output: 'tests-examples/textbook2/tables/5_1_2.csv'
const:
  - Ivana Teach
  - History
attrs:
  - fname
  - age
  - major
aggrs:
  - max
comment: |
  SELECT MAX(S.age)
  FROM Student S
  WHERE (S.major = 'History')
     OR S.snum IN (SELECT E.snum
                   FROM Class C,
                        Enrolled E,
                        Faculty F
                   WHERE E.cname = C.name
                     AND C.fid = F.fid
                     AND F.fname = 'Ivana Teach')

  df1 <- inner_join(inner_join(inner_join(input3, input2), input4), input1)
  df2 <- df1 %>% filter(fname == 'Ivana Teach' | major == 'History')
  df3 <- df2 %>% group_by(cname) %>% summarise(maxage = max(age)) %>% ungroup()
  out <- df3 %>% select(maxage)